'use strict';

var _extends = require('babel-runtime/helpers/extends')['default'];

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _bluebird = require('bluebird');

var _bluebird2 = _interopRequireDefault(_bluebird);

var _path = require('path');

var _path2 = _interopRequireDefault(_path);

var _chaiAsPromised = require('chai-as-promised');

var _chaiAsPromised2 = _interopRequireDefault(_chaiAsPromised);

var _desired = require('../../desired');

var _helpersSession = require('../../helpers/session');

_chai2['default'].should();
_chai2['default'].use(_chaiAsPromised2['default']);

var START_IMG = _path2['default'].resolve('.', 'test', 'functional', 'assets', 'start-button.png');
var STOP_IMG = _path2['default'].resolve('.', 'test', 'functional', 'assets', 'stop-button.png');
var SQUARES_IMG = _path2['default'].resolve('.', 'test', 'functional', 'assets', 'checkered-squares.png');

describe('Find - Image @skip-ci', function () {
  var driver = undefined;

  before(function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap((0, _helpersSession.initDriver)(_extends({}, _desired.APIDEMOS_CAPS, {
            appActivity: ".view.ChronometerDemo"
          })));

        case 2:
          driver = context$2$0.sent;
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap(driver.updateSettings({
            fixImageTemplateSize: true,
            autoUpdateImageElementPosition: true
          }));

        case 5:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });

  after(function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.quit());

        case 2:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });

  it('should find image elements', function callee$1$0() {
    var els;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.elementsByImageFile(START_IMG));

        case 2:
          els = context$2$0.sent;

          els.should.have.length(1);

        case 4:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });
  it('should find an image element', function callee$1$0() {
    var el;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.elementByImageFile(START_IMG));

        case 2:
          el = context$2$0.sent;

          el.value.should.match(/appium-image-element/);

        case 4:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });
  it('should not find an image element that is not matched', function callee$1$0() {
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.elementByImageFile(SQUARES_IMG).should.eventually.be.rejectedWith(/Error response status: 7/));

        case 2:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });
  it('should find anything with a threshold low enough', function callee$1$0() {
    var _ref, imageMatchThreshold;

    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.settings());

        case 2:
          _ref = context$2$0.sent;
          imageMatchThreshold = _ref.imageMatchThreshold;
          context$2$0.next = 6;
          return _regeneratorRuntime.awrap(driver.updateSettings({ imageMatchThreshold: 0 }));

        case 6:
          context$2$0.prev = 6;
          context$2$0.next = 9;
          return _regeneratorRuntime.awrap(driver.elementByImageFile(SQUARES_IMG).should.eventually.exist);

        case 9:
          context$2$0.prev = 9;
          context$2$0.next = 12;
          return _regeneratorRuntime.awrap(driver.updateSettings({ imageMatchThreshold: imageMatchThreshold }));

        case 12:
          return context$2$0.finish(9);

        case 13:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this, [[6,, 9, 13]]);
  });
  it('should be able to get basic element properties', function callee$1$0() {
    var el, size, loc, locInView;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.elementByImageFile(START_IMG));

        case 2:
          el = context$2$0.sent;
          context$2$0.next = 5;
          return _regeneratorRuntime.awrap(el.isDisplayed().should.eventually.be['true']);

        case 5:
          context$2$0.next = 7;
          return _regeneratorRuntime.awrap(el.getSize());

        case 7:
          size = context$2$0.sent;

          size.width.should.be.above(0);
          size.height.should.be.above(0);
          context$2$0.next = 12;
          return _regeneratorRuntime.awrap(el.getLocation());

        case 12:
          loc = context$2$0.sent;

          loc.x.should.be.at.least(0);
          loc.y.should.be.at.least(0);
          context$2$0.next = 17;
          return _regeneratorRuntime.awrap(el.getLocationInView());

        case 17:
          locInView = context$2$0.sent;

          locInView.x.should.eql(loc.x);
          locInView.y.should.eql(loc.y);

        case 20:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });
  it('should be able to click an element', function callee$1$0() {
    var readout, text, match, secs;
    return _regeneratorRuntime.async(function callee$1$0$(context$2$0) {
      while (1) switch (context$2$0.prev = context$2$0.next) {
        case 0:
          context$2$0.next = 2;
          return _regeneratorRuntime.awrap(driver.elementByImageFile(START_IMG).click());

        case 2:
          context$2$0.next = 4;
          return _regeneratorRuntime.awrap(_bluebird2['default'].delay(3000));

        case 4:
          context$2$0.next = 6;
          return _regeneratorRuntime.awrap(driver.elementByImageFile(STOP_IMG).click());

        case 6:
          context$2$0.next = 8;
          return _regeneratorRuntime.awrap(driver.elementByXPath("//*[contains(@text, 'Initial format')]"));

        case 8:
          readout = context$2$0.sent;
          context$2$0.next = 11;
          return _regeneratorRuntime.awrap(readout.text());

        case 11:
          text = context$2$0.sent;
          match = /Initial format: \d\d:(\d\d)/.exec(text);
          secs = parseInt(match[1], 10);

          secs.should.be.above(2);
          secs.should.be.below(20);

        case 16:
        case 'end':
          return context$2$0.stop();
      }
    }, null, this);
  });
});

// use the driver settings that cause the most code paths to be exercised

// start and stop the chronometer using images, and then verify the time
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvZnVuY3Rpb25hbC9jb21tYW5kcy9maW5kL2J5LWltYWdlLWUyZS1zcGVjcy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7OztvQkFBaUIsTUFBTTs7Ozt3QkFDVCxVQUFVOzs7O29CQUNQLE1BQU07Ozs7OEJBQ0ksa0JBQWtCOzs7O3VCQUNmLGVBQWU7OzhCQUNsQix1QkFBdUI7O0FBR2xELGtCQUFLLE1BQU0sRUFBRSxDQUFDO0FBQ2Qsa0JBQUssR0FBRyw2QkFBZ0IsQ0FBQzs7QUFFekIsSUFBTSxTQUFTLEdBQUcsa0JBQUssT0FBTyxDQUFDLEdBQUcsRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFFLFFBQVEsRUFBRSxrQkFBa0IsQ0FBQyxDQUFDO0FBQ3hGLElBQU0sUUFBUSxHQUFHLGtCQUFLLE9BQU8sQ0FBQyxHQUFHLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBRSxRQUFRLEVBQUUsaUJBQWlCLENBQUMsQ0FBQztBQUN0RixJQUFNLFdBQVcsR0FBRyxrQkFBSyxPQUFPLENBQUMsR0FBRyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsUUFBUSxFQUFFLHVCQUF1QixDQUFDLENBQUM7O0FBRS9GLFFBQVEsQ0FBQyx1QkFBdUIsRUFBRSxZQUFZO0FBQzVDLE1BQUksTUFBTSxZQUFBLENBQUM7O0FBRVgsUUFBTSxDQUFDOzs7OzsyQ0FDVTtBQUViLHVCQUFXLEVBQUUsdUJBQXVCO2FBQ3BDOzs7QUFIRixnQkFBTTs7MkNBS0EsTUFBTSxDQUFDLGNBQWMsQ0FBQztBQUMxQixnQ0FBb0IsRUFBRSxJQUFJO0FBQzFCLDBDQUE4QixFQUFFLElBQUk7V0FDckMsQ0FBQzs7Ozs7OztHQUNILENBQUMsQ0FBQzs7QUFFSCxPQUFLLENBQUM7Ozs7OzJDQUNFLE1BQU0sQ0FBQyxJQUFJLEVBQUU7Ozs7Ozs7R0FDcEIsQ0FBQyxDQUFDOztBQUVILElBQUUsQ0FBQyw0QkFBNEIsRUFBRTtRQUMzQixHQUFHOzs7OzsyQ0FBUyxNQUFNLENBQUMsbUJBQW1CLENBQUMsU0FBUyxDQUFDOzs7QUFBakQsYUFBRzs7QUFDUCxhQUFHLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7Ozs7Ozs7R0FDM0IsQ0FBQyxDQUFDO0FBQ0gsSUFBRSxDQUFDLDhCQUE4QixFQUFFO1FBQzdCLEVBQUU7Ozs7OzJDQUFTLE1BQU0sQ0FBQyxrQkFBa0IsQ0FBQyxTQUFTLENBQUM7OztBQUEvQyxZQUFFOztBQUNOLFlBQUUsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDOzs7Ozs7O0dBQy9DLENBQUMsQ0FBQztBQUNILElBQUUsQ0FBQyxzREFBc0QsRUFBRTs7Ozs7MkNBQ25ELE1BQU0sQ0FBQyxrQkFBa0IsQ0FBQyxXQUFXLENBQUMsQ0FDekMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUMsWUFBWSxDQUFDLDBCQUEwQixDQUFDOzs7Ozs7O0dBQ2pFLENBQUMsQ0FBQztBQUNILElBQUUsQ0FBQyxrREFBa0QsRUFBRTtjQUM5QyxtQkFBbUI7Ozs7OzsyQ0FBVSxNQUFNLENBQUMsUUFBUSxFQUFFOzs7O0FBQTlDLDZCQUFtQixRQUFuQixtQkFBbUI7OzJDQUNwQixNQUFNLENBQUMsY0FBYyxDQUFDLEVBQUMsbUJBQW1CLEVBQUUsQ0FBQyxFQUFDLENBQUM7Ozs7OzJDQUU3QyxNQUFNLENBQUMsa0JBQWtCLENBQUMsV0FBVyxDQUFDLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxLQUFLOzs7OzsyQ0FFOUQsTUFBTSxDQUFDLGNBQWMsQ0FBQyxFQUFDLG1CQUFtQixFQUFuQixtQkFBbUIsRUFBQyxDQUFDOzs7Ozs7Ozs7O0dBRXJELENBQUMsQ0FBQztBQUNILElBQUUsQ0FBQyxnREFBZ0QsRUFBRTtRQUMvQyxFQUFFLEVBRUYsSUFBSSxFQUdKLEdBQUcsRUFHSCxTQUFTOzs7OzsyQ0FSRSxNQUFNLENBQUMsa0JBQWtCLENBQUMsU0FBUyxDQUFDOzs7QUFBL0MsWUFBRTs7MkNBQ0EsRUFBRSxDQUFDLFdBQVcsRUFBRSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsRUFBRSxRQUFLOzs7OzJDQUMvQixFQUFFLENBQUMsT0FBTyxFQUFFOzs7QUFBekIsY0FBSTs7QUFDUixjQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQzlCLGNBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7OzJDQUNmLEVBQUUsQ0FBQyxXQUFXLEVBQUU7OztBQUE1QixhQUFHOztBQUNQLGFBQUcsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQzVCLGFBQUcsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDOzsyQ0FDTixFQUFFLENBQUMsaUJBQWlCLEVBQUU7OztBQUF4QyxtQkFBUzs7QUFDYixtQkFBUyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUM5QixtQkFBUyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQzs7Ozs7OztHQUMvQixDQUFDLENBQUM7QUFDSCxJQUFFLENBQUMsb0NBQW9DLEVBQUU7UUFLbkMsT0FBTyxFQUNQLElBQUksRUFDSixLQUFLLEVBQ0wsSUFBSTs7Ozs7MkNBTkYsTUFBTSxDQUFDLGtCQUFrQixDQUFDLFNBQVMsQ0FBQyxDQUFDLEtBQUssRUFBRTs7OzsyQ0FDNUMsc0JBQUUsS0FBSyxDQUFDLElBQUksQ0FBQzs7OzsyQ0FDYixNQUFNLENBQUMsa0JBQWtCLENBQUMsUUFBUSxDQUFDLENBQUMsS0FBSyxFQUFFOzs7OzJDQUM3QixNQUFNLENBQUMsY0FBYyxDQUFDLHdDQUF3QyxDQUFDOzs7QUFBL0UsaUJBQU87OzJDQUNNLE9BQU8sQ0FBQyxJQUFJLEVBQUU7OztBQUEzQixjQUFJO0FBQ0osZUFBSyxHQUFHLDZCQUE2QixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUM7QUFDaEQsY0FBSSxHQUFHLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDOztBQUNqQyxjQUFJLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDeEIsY0FBSSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDOzs7Ozs7O0dBQzFCLENBQUMsQ0FBQztDQUNKLENBQUMsQ0FBQyIsImZpbGUiOiJ0ZXN0L2Z1bmN0aW9uYWwvY29tbWFuZHMvZmluZC9ieS1pbWFnZS1lMmUtc3BlY3MuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgY2hhaSBmcm9tICdjaGFpJztcbmltcG9ydCBCIGZyb20gJ2JsdWViaXJkJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IGNoYWlBc1Byb21pc2VkIGZyb20gJ2NoYWktYXMtcHJvbWlzZWQnO1xuaW1wb3J0IHsgQVBJREVNT1NfQ0FQUyB9IGZyb20gJy4uLy4uL2Rlc2lyZWQnO1xuaW1wb3J0IHsgaW5pdERyaXZlciB9IGZyb20gJy4uLy4uL2hlbHBlcnMvc2Vzc2lvbic7XG5cblxuY2hhaS5zaG91bGQoKTtcbmNoYWkudXNlKGNoYWlBc1Byb21pc2VkKTtcblxuY29uc3QgU1RBUlRfSU1HID0gcGF0aC5yZXNvbHZlKCcuJywgJ3Rlc3QnLCAnZnVuY3Rpb25hbCcsICdhc3NldHMnLCAnc3RhcnQtYnV0dG9uLnBuZycpO1xuY29uc3QgU1RPUF9JTUcgPSBwYXRoLnJlc29sdmUoJy4nLCAndGVzdCcsICdmdW5jdGlvbmFsJywgJ2Fzc2V0cycsICdzdG9wLWJ1dHRvbi5wbmcnKTtcbmNvbnN0IFNRVUFSRVNfSU1HID0gcGF0aC5yZXNvbHZlKCcuJywgJ3Rlc3QnLCAnZnVuY3Rpb25hbCcsICdhc3NldHMnLCAnY2hlY2tlcmVkLXNxdWFyZXMucG5nJyk7XG5cbmRlc2NyaWJlKCdGaW5kIC0gSW1hZ2UgQHNraXAtY2knLCBmdW5jdGlvbiAoKSB7XG4gIGxldCBkcml2ZXI7XG5cbiAgYmVmb3JlKGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICBkcml2ZXIgPSBhd2FpdCBpbml0RHJpdmVyKHtcbiAgICAgIC4uLkFQSURFTU9TX0NBUFMsXG4gICAgICBhcHBBY3Rpdml0eTogXCIudmlldy5DaHJvbm9tZXRlckRlbW9cIlxuICAgIH0pO1xuICAgIC8vIHVzZSB0aGUgZHJpdmVyIHNldHRpbmdzIHRoYXQgY2F1c2UgdGhlIG1vc3QgY29kZSBwYXRocyB0byBiZSBleGVyY2lzZWRcbiAgICBhd2FpdCBkcml2ZXIudXBkYXRlU2V0dGluZ3Moe1xuICAgICAgZml4SW1hZ2VUZW1wbGF0ZVNpemU6IHRydWUsXG4gICAgICBhdXRvVXBkYXRlSW1hZ2VFbGVtZW50UG9zaXRpb246IHRydWUsXG4gICAgfSk7XG4gIH0pO1xuXG4gIGFmdGVyKGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICBhd2FpdCBkcml2ZXIucXVpdCgpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGZpbmQgaW1hZ2UgZWxlbWVudHMnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgbGV0IGVscyA9IGF3YWl0IGRyaXZlci5lbGVtZW50c0J5SW1hZ2VGaWxlKFNUQVJUX0lNRyk7XG4gICAgZWxzLnNob3VsZC5oYXZlLmxlbmd0aCgxKTtcbiAgfSk7XG4gIGl0KCdzaG91bGQgZmluZCBhbiBpbWFnZSBlbGVtZW50JywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgIGxldCBlbCA9IGF3YWl0IGRyaXZlci5lbGVtZW50QnlJbWFnZUZpbGUoU1RBUlRfSU1HKTtcbiAgICBlbC52YWx1ZS5zaG91bGQubWF0Y2goL2FwcGl1bS1pbWFnZS1lbGVtZW50Lyk7XG4gIH0pO1xuICBpdCgnc2hvdWxkIG5vdCBmaW5kIGFuIGltYWdlIGVsZW1lbnQgdGhhdCBpcyBub3QgbWF0Y2hlZCcsIGFzeW5jIGZ1bmN0aW9uICgpIHtcbiAgICBhd2FpdCBkcml2ZXIuZWxlbWVudEJ5SW1hZ2VGaWxlKFNRVUFSRVNfSU1HKVxuICAgICAgLnNob3VsZC5ldmVudHVhbGx5LmJlLnJlamVjdGVkV2l0aCgvRXJyb3IgcmVzcG9uc2Ugc3RhdHVzOiA3Lyk7XG4gIH0pO1xuICBpdCgnc2hvdWxkIGZpbmQgYW55dGhpbmcgd2l0aCBhIHRocmVzaG9sZCBsb3cgZW5vdWdoJywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0IHtpbWFnZU1hdGNoVGhyZXNob2xkfSA9IGF3YWl0IGRyaXZlci5zZXR0aW5ncygpO1xuICAgIGF3YWl0IGRyaXZlci51cGRhdGVTZXR0aW5ncyh7aW1hZ2VNYXRjaFRocmVzaG9sZDogMH0pO1xuICAgIHRyeSB7XG4gICAgICBhd2FpdCBkcml2ZXIuZWxlbWVudEJ5SW1hZ2VGaWxlKFNRVUFSRVNfSU1HKS5zaG91bGQuZXZlbnR1YWxseS5leGlzdDtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgYXdhaXQgZHJpdmVyLnVwZGF0ZVNldHRpbmdzKHtpbWFnZU1hdGNoVGhyZXNob2xkfSk7XG4gICAgfVxuICB9KTtcbiAgaXQoJ3Nob3VsZCBiZSBhYmxlIHRvIGdldCBiYXNpYyBlbGVtZW50IHByb3BlcnRpZXMnLCBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgbGV0IGVsID0gYXdhaXQgZHJpdmVyLmVsZW1lbnRCeUltYWdlRmlsZShTVEFSVF9JTUcpO1xuICAgIGF3YWl0IGVsLmlzRGlzcGxheWVkKCkuc2hvdWxkLmV2ZW50dWFsbHkuYmUudHJ1ZTtcbiAgICBsZXQgc2l6ZSA9IGF3YWl0IGVsLmdldFNpemUoKTtcbiAgICBzaXplLndpZHRoLnNob3VsZC5iZS5hYm92ZSgwKTtcbiAgICBzaXplLmhlaWdodC5zaG91bGQuYmUuYWJvdmUoMCk7XG4gICAgbGV0IGxvYyA9IGF3YWl0IGVsLmdldExvY2F0aW9uKCk7XG4gICAgbG9jLnguc2hvdWxkLmJlLmF0LmxlYXN0KDApO1xuICAgIGxvYy55LnNob3VsZC5iZS5hdC5sZWFzdCgwKTtcbiAgICBsZXQgbG9jSW5WaWV3ID0gYXdhaXQgZWwuZ2V0TG9jYXRpb25JblZpZXcoKTtcbiAgICBsb2NJblZpZXcueC5zaG91bGQuZXFsKGxvYy54KTtcbiAgICBsb2NJblZpZXcueS5zaG91bGQuZXFsKGxvYy55KTtcbiAgfSk7XG4gIGl0KCdzaG91bGQgYmUgYWJsZSB0byBjbGljayBhbiBlbGVtZW50JywgYXN5bmMgZnVuY3Rpb24gKCkge1xuICAgIC8vIHN0YXJ0IGFuZCBzdG9wIHRoZSBjaHJvbm9tZXRlciB1c2luZyBpbWFnZXMsIGFuZCB0aGVuIHZlcmlmeSB0aGUgdGltZVxuICAgIGF3YWl0IGRyaXZlci5lbGVtZW50QnlJbWFnZUZpbGUoU1RBUlRfSU1HKS5jbGljaygpO1xuICAgIGF3YWl0IEIuZGVsYXkoMzAwMCk7XG4gICAgYXdhaXQgZHJpdmVyLmVsZW1lbnRCeUltYWdlRmlsZShTVE9QX0lNRykuY2xpY2soKTtcbiAgICBsZXQgcmVhZG91dCA9IGF3YWl0IGRyaXZlci5lbGVtZW50QnlYUGF0aChcIi8vKltjb250YWlucyhAdGV4dCwgJ0luaXRpYWwgZm9ybWF0JyldXCIpO1xuICAgIGxldCB0ZXh0ID0gYXdhaXQgcmVhZG91dC50ZXh0KCk7XG4gICAgbGV0IG1hdGNoID0gL0luaXRpYWwgZm9ybWF0OiBcXGRcXGQ6KFxcZFxcZCkvLmV4ZWModGV4dCk7XG4gICAgbGV0IHNlY3MgPSBwYXJzZUludChtYXRjaFsxXSwgMTApO1xuICAgIHNlY3Muc2hvdWxkLmJlLmFib3ZlKDIpO1xuICAgIHNlY3Muc2hvdWxkLmJlLmJlbG93KDIwKTtcbiAgfSk7XG59KTtcbiJdLCJzb3VyY2VSb290IjoiLi4vLi4vLi4vLi4vLi4ifQ==
